<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>文件上传</title>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}">
</head>
<body>
<!--layui文件上传-->
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
    <legend><h4>请在此处上传文件</h4></legend>
</fieldset>

<div class="layui-upload-drag" id="fileUpload">
    <i class="layui-icon"></i>
    <p>点击上传，或将文件拖拽到此处</p>
    <div class="layui-hide" id="uploadDemoView">
        <hr>
        <input src="" alt="上传成功后渲染" style="max-width: 196px">
    </div>
</div>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend><h4>已上传文件信息</h4></legend>
</fieldset>
<!--查询表单-->
<form class="layui-form" action="">
    <div class="layui-form-item">
        <div class="layui-inline">
            <label class="layui-form-label">文件名：</label>
            <div class="layui-input-inline">
                <input type="text" name="fileName" id="fileName" autocomplete="off" class="layui-input"
                       lay-verify="required"
                       placeholder="模糊查询">
            </div>
        </div>
        <div class="layui-inline">
            <label class="layui-form-label">上传时间：</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" name="uploadDate" id="uploadDate" placeholder="yyyy-MM-dd"
                       lay-verify="required|date">
            </div>
        </div>
        &nbsp; &nbsp; &nbsp;
        <div class="layui-inline">
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1"> 查询</button>
        </div>
    </div>
</form>
<!--数据展示-->
<table class="layui-hide" id="fileTable" lay-filter="fileTable"></table>

<style>
    body {
        margin: 10px;
    }

    h4 {
        color: #009688;
    }

    .layui-upload-drag {
        width: 95%;
    }
</style>
<script type="text/html" id="barDemo">
    <a class="layui-btn  layui-btn-sm" lay-event="detail">查看</a>
    <a class="layui-btn  layui-btn-sm layui-btn-danger" lay-event="del">删除</a>
</script>
<!-- 引入 layui.js 的 <script> 标签最好放置在 html 末尾 -->
<script th:src="@{/layui/layui.js}"></script>
<script th:inline="javascript" type="text/javascript">
    // /*<![CDDATA[*/

    let ctxPath = [[@{/}]];

        layui.use(['upload', 'element', 'layer', 'table', 'laydate', 'form'], function () {
            var $ = layui.jquery
                , upload = layui.upload
                , table = layui.table
                , layer = layui.layer
                , laydate = layui.laydate
                , form = layui.form;

            //常规时间渲染用法
            laydate.render({
                elem: '#uploadDate'
            });
            //拖拽上传
            upload.render({
                elem: '#fileUpload'
                , accept: 'file'
                , url: ctxPath + 'requirement/file/import'
                , done: function (res) {
                    console.log(res);
                    if (res) {
                        layer.msg('数据导入成功！');
                        layui.$('#uploadDemoView').removeClass('layui-hide').find('xlsx').attr('src', res.files.file);
                    } else {
                        layer.alert('数据导入失败，请检查数据模板！');
                    }
                }
            });

            // 表格展示
            table.render({
                elem: '#fileTable'
                // ,url: '../../demo/table/user/-page=1&limit=20.js'
                , data: [{
                    "id": "1",
                    "fileName": "文件1",
                    "ip": "127.0.0.1",
                    "uploadDate": "2023-1-20",
                    "status": 1
                }, {"id": "2", "fileName": "文件2", "ip": "127.0.0.1", "uploadDate": "2023-1-21", "status": 0}]
                , cols: [
                    [{type: 'numbers', title: '序号', width: 40, align: 'center', fixed: 'left'}
                        , {field: 'fileName', minWidth: 100, title: '文件名', align: 'center'}
                        , {field: 'ip', minWidth: 100, title: '上传IP', align: 'center'}
                        , {field: 'uploadDate', minWidth: 80, title: '上传时间', align: 'center'}
                        , {
                        field: 'status', title: '上传状态', width: 100, align: 'center',
                        templet: function (d) {
                            var status = d.status;
                            if (status == 1) {
                                return '<span style="color: #098029;">成功</span>';
                            } else {
                                return '<span style="color: #80131e;">失败</span>';
                            }
                        }
                    }
                        , {field: '', width: 200, title: '操作', fixed: 'right', align: 'center', toolbar: '#barDemo'}
                    ]]// 避免layui和thymeleaf符号冲突，此处[ [格式不要改动
                , even: true
                , page: true
            });

            //监听工具条
            table.on('tool(fileTable)', function (obj) {
                var data = obj.data;
                if (obj.event === 'detail') {
                    layer.msg('ID：' + data.id + ' 的查看操作');
                } else if (obj.event === 'del') {
                    layer.confirm('真的删除行么', function (index) {
                        obj.del();
                        layer.close(index);
                    });
                }
            });

            //监听提交
            form.on('submit(demo1)', function (data) {
                layer.alert(JSON.stringify(data.field), {
                    title: '最终的提交信息'
                });

                tableReload();
                return false;
            });

            function tableReload() {
                layer.msg("表格重载");
                // 表格数据重载
                table.reload('fileTable', {
                    where: { //设定异步数据接口的额外参数，任意设
                        aaaaaa: 'xxx'
                        , bbb: 'yyy'
                        //…
                    }
                    , page: {
                        curr: 1 //重新从第 1 页开始
                    }
                }); //只重载数据
            }
        });

    // /*]]>*/
</script>
</body>
</html>